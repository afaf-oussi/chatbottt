
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Chatbot Step 3.5 Flash</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #chat-window { width: 450px; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow: hidden; }
        #log { height: 350px; overflow-y: auto; padding: 15px; border-bottom: 1px solid #ddd; display: flex; flex-direction: column; gap: 8px; }
        .msg { padding: 8px 12px; border-radius: 10px; font-size: 14px; max-width: 85%; }
        .user { align-self: flex-end; background: #007bff; color: white; }
        .bot { align-self: flex-start; background: #eee; }
        .debug { font-size: 11px; color: #d9534f; background: #f9f2f4; padding: 5px; border-radius: 5px; border: 1px solid #d9534f; }
        #controls { display: flex; padding: 10px; background: #fff; }
        input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; outline: none; }
        button { margin-left: 5px; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div id="chat-window">
    <div style="background:#007bff; color:white; padding:10px; text-align:center;">Diagnostic Step 3.5</div>
    <div id="log"></div>
    <div id="controls">
        <input type="text" id="userInput" placeholder="Écrivez ici...">
        <button id="btn">OK</button>
    </div>
</div>

<script>
    // COLLEZ VOTRE CLÉ ICI (elle doit commencer par sk-or-v1-...)
    const MY_KEY = "VOTRE_CLE_API_ICI"; 

    const log = document.getElementById('log');
    const input = document.getElementById('userInput');
    const btn = document.getElementById('btn');

    function print(role, text, isDebug = false) {
        const d = document.createElement('div');
        d.className = isDebug ? 'debug' : `msg ${role}`;
        d.innerText = text;
        log.appendChild(d);
        log.scrollTop = log.scrollHeight;
    }

    async function startChat() {
        const text = input.value.trim();
        if (!text) return;

        print('user', text);
        input.value = "";
        btn.disabled = true;

        try {
            const resp = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${MY_KEY}`,
                    "Content-Type": "application/json",
                    "HTTP-Referer": window.location.origin // Requis par OpenRouter
                },
                body: JSON.stringify({
                    "model": "stepfun/step-3.5-flash:free",
                    "messages": [{"role": "user", "content": text}]
                })
            });

            const data = await resp.json();

            if (data.error) {
                // Affiche l'erreur RÉELLE renvoyée par OpenRouter
                print('bot', "Détails de l'erreur :", true);
                print('bot', JSON.stringify(data.error), true);
            } else {
                print('bot', data.choices[0].message.content);
            }
        } catch (e) {
            print('bot', "Erreur réseau/navigateur : " + e.message, true);
        } finally {
            btn.disabled = false;
        }
    }

    btn.onclick = startChat;
    input.onkeypress = (e) => { if(e.key === 'Enter') startChat(); };
</script>
</body>
</html>
